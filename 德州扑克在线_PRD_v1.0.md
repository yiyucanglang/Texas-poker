# 《德州扑克在线》产品需求文档 (PRD)

| **文档状态** | **[最终定稿]** | **版本号** | **v2.0** |
| :--- | :--- | :--- | :--- |
| **创建日期** | 2025-07-31 | **创建人** | [您的名字] |
| **最后更新** | 2025-07-31 | **更新人** | Gemini AI |

## 1. 项目概述

### 1.1 项目愿景
为小范围的熟人社交圈（如朋友、同事）提供一个简单、私密、无干扰的线上德州扑克组局与记分工具，专注于复刻线下家庭局的纯粹娱乐体验。

### 1.2 目标用户
- **核心用户:** 有固定牌友圈，希望有一个便捷线上工具进行娱乐和记分的德州扑克爱好者。

---

## MVP 范围（第一阶段）

- 用户注册/登录
- 创建/加入房间
- 发牌逻辑与比牌（服务端）
- 简单 UI + 游戏操作
- 底池结算（不含边池）

---

## 2. 功能需求 (Functional Requirements)

### 2.1 用户账户模块
- **2.1.1 用户注册:** 用户可以使用一个唯一的“用户名”和“密码”来创建账户。
- **2.1.2 用户登录:** 已注册用户可以使用其“用户名”和“密码”进行登录。
- **2.1.3 个人信息:** 用户可以自定义设置自己的“头像”。
- **2.1.4 历史战绩:**
    - 系统应记录用户参与的每一场完整牌局（从加入到最终离开房间）。
    - 用户可以在个人中心查看历史战绩列表。
    - 点击任意一条战绩，可查看该场牌局的详情回顾，结构如下：
        - 牌局 ID
        - 开始时间 / 结束时间
        - 玩家列表:
            - 昵称、买入次数、总买入额、最终筹码、盈亏

### 2.2 游戏房间模块
- **2.2.1 房间创建:**
    - 用户可以创建一个新的游戏房间。
    - 创建时，用户必须可以自定义以下参数：
        - `房间名称`
        - `游戏人数` (2-9人)
        - `大小盲注` (Big Blind需至少为Small Blind的两倍)
        - `最小/最大带入额` (Min Buy-in需至少为一个Big Blind)
        - `行动时间` (例如15秒、30秒、60秒)
    - 房间创建成功后，系统应生成一个全局唯一的“房间号”用于邀请。
- **2.2.2 房间加入:**
    - 用户可以通过输入有效的“房间号”来加入一个未满员的房间。
    - **单一房间限制:** 一个用户在任何时候只能存在于一个游戏房间内。
- **2.2.3 房间大厅 (Lobby):**
    - 玩家加入房间后，进入等待状态。
    - 玩家可以选择一个空座位，并决定首次带入的筹码数量（需在房主设定的最小/最大带入额范围内）。
    - **房主控制权:** 只有房主（创建房间的用户）可以开始游戏。开始前所有已坐下的玩家均处于等待状态。
    - 房主必须在至少有2名玩家坐下后，才能开始游戏。

### 2.3 游戏流程模块
- **2.3.1 游戏模式:** 仅支持“无限制德州扑克 (No-Limit Texas Hold'em)”的常规桌 (Cash Game) 模式。
- **2.3.2 游戏开始:**
    - 房主开始游戏后，第一局的“庄家按钮 (Dealer Button)”位置随机分配。之后每局按顺时针方向移动。
    - 庄家按钮左侧玩家自动支付“小盲注”，再左侧玩家自动支付“大盲注”。
- **2.3.3 游戏操作 (主流规则):**
    - **行动顺序:** 从大盲注左侧玩家开始，按顺时针方向行动。
    - **可用操作:**
        - `弃牌 (Fold)`
        - `过牌 (Check)`
        - `下注 (Bet)`
        - `跟注 (Call)`
        - `加注 (Raise)`
        - `全下 (All-in)`
    - **行动超时:** 若玩家在“行动时间”内未操作：
        - 若当前可以“过牌”，则自动“过牌”；
        - 否则自动“弃牌”。
- **2.3.4 牌局流程:**
    - 四轮下注：翻前、翻牌圈、转牌圈、河牌圈。
    - 每轮结束后，发相应公共牌。
- **2.3.5 牌局结算 (Showdown):**
    - 若仍有2人或以上未弃牌，则比牌决胜。
    - 系统根据标准牌型规则自动判断胜者，分配底池。
    - **支持分池 (Side Pot):** 系统能正确处理 All-in 时的主池与边池。
- **2.3.6 牌桌内功能:**
    - **加码:** 每手牌结束后，玩家可补充筹码。
- **2.3.7 断线重连:**
    - 玩家断线后其座位与筹码保留 10 分钟；
    - 若其期间重新登录，可自动恢复原牌局状态与位置（包括手牌与桌面）；
    - 房主可踢出长时间离线玩家（或系统超时自动站起）。

### 2.4 功能性需求
- **2.4.1 公平性:**
    - 发牌使用 Fisher–Yates Shuffle 算法；
    - 随机数使用 Node.js 内置 `crypto.randomInt()`；
    - 可支持“发牌种子 + 洗牌哈希”方式供后续版本验证公平性。
- **2.4.2 安全性:**
    - 禁止客户端透视他人手牌；
    - 防止作弊方式如：篡改下注、伪造筹码等；
    - 所有发牌与比牌逻辑严格放在服务端执行。
